<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Real-time Stock Signal Dashboard</title>
    <link rel="icon" type="image/png" href="logo.png">
  <!-- Using Chart.js as a robust fallback to avoid library runtime issues -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <style>
    :root{
      --bg:#0b0f14;--card:#0f1720;--muted:#93a3b6;--accent:#d8e0e2;--green:#26d07b;--red:#ff6b6b;--glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#061118 0%, #071421 60%);color:#d8e6ef}
    .app{max-width:1400px;margin:32px auto;padding:20px;}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:24px;backdrop-filter:blur(12px);background:rgba(15,23,32,0.4);padding:16px 20px;border-radius:16px;border:1px solid rgba(255,255,255,0.06)}
    .brand{display:flex;gap:14px;align-items:center}
    .logo{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);padding:4px}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    input[type=text]{background:var(--glass);border:1px solid rgba(255,255,255,0.08);padding:11px 14px;border-radius:10px;color:inherit;width:160px;transition:all 0.2s;font-size:14px}
    input[type=text]:focus{outline:none;border-color:rgba(255,255,255,0.15);background:rgba(255,255,255,0.05)}
    select{background:var(--glass);border:1px solid rgba(255,255,255,0.08);padding:11px 14px;border-radius:10px;color:inherit;cursor:pointer;transition:all 0.2s;font-size:14px}
    select:hover{border-color:rgba(255,255,255,0.12);background:rgba(255,255,255,0.04)}
    button{background:linear-gradient(135deg,var(--accent),#b8c4c7);border:0;padding:11px 18px;border-radius:10px;color:#041018;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 12px rgba(216,224,226,0.15);font-size:14px}
    button:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(216,224,226,0.25)}

    .grid{display:grid;grid-template-columns:1fr 380px;gap:20px;margin-top:20px}
    .card{background:linear-gradient(145deg,rgba(15,23,32,0.8), rgba(7,20,33,0.6));backdrop-filter:blur(20px);border-radius:16px;padding:18px;box-shadow:0 8px 32px rgba(2,6,10,0.4);border:1px solid rgba(255,255,255,0.06);transition:all 0.3s}
    .card:hover{border-color:rgba(255,255,255,0.1);box-shadow:0 12px 40px rgba(2,6,10,0.6)}
    #chartWrapper{height:460px;padding:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;display:flex;align-items:center}
    canvas{width:100% !important;height:100% !important}
  .gradient-text {
    font-size: 2rem; /* same as text-2xl */
    font-weight: bold;
    background: linear-gradient(to right, #ffffff, #929499, #797986); /* green to blue to indigo */
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent; /* makes the text show the gradient */
  }
    .rightCol{display:flex;flex-direction:column;gap:16px}
    .signalBadge{display:flex;align-items:center;gap:14px;padding:18px;border-radius:14px;transition:all 0.3s}
    .signalBadge:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(0,0,0,0.4)}
    .signalText{font-size:24px;font-weight:800;letter-spacing:-0.5px}
    .signalDesc{color:var(--muted);font-size:13px;margin-top:4px}
    .metrics{display:flex;gap:10px;flex-wrap:wrap;margin-top:4px}
    .metric{background:rgba(255,255,255,0.03);padding:10px 12px;border-radius:10px;min-width:100px;border:1px solid rgba(255,255,255,0.04);transition:all 0.2s}
    .metric:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.08)}
    .smallChart{height:120px;background:transparent;margin-top:8px}
    .explain{font-size:13px;color:var(--muted);line-height:1.5}
    footer{margin-top:24px;color:var(--muted);font-size:13px;text-align:center;padding:16px;background:rgba(255,255,255,0.02);border-radius:12px;border:1px solid rgba(255,255,255,0.04)}

    /* colors for signals */
    .buy{background:linear-gradient(90deg, rgba(38,208,123,0.12), rgba(0,213,255,0.03));border-left:4px solid var(--green)}
    .sell{background:linear-gradient(90deg, rgba(255,107,107,0.07), rgba(107,91,255,0.02));border-left:4px solid var(--red)}
    .hold{background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);border-left:4px solid rgba(255,255,255,0.03)}

    .muted{color:var(--muted);font-size:13px;font-weight:500}
    .row{display:flex;gap:10px;align-items:center}
    .conf{font-size:32px;font-weight:800;letter-spacing:-1px}
    
    .indicator-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.06)}

    @media(max-width:980px){.grid{grid-template-columns:1fr;}.rightCol{order:2}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo"><img src="logo.png" width="50px"> </div> 
        <span class="gradient-text">BeneficentTrader</span>
      </div>

      <div class="controls">
        <input id="symbol" type="text" placeholder="Enter a Ticker" value="" color="white" />
        <select id="interval">
          <option value="1min">1m</option>
          <option value="5min" selected>5m</option>
          <option value="15min">15m</option>
          <option value="1h">1h</option>
          <option value="1day">1D</option>
        </select>
        <select id="chartRange">
          <option value="100">100 bars</option>
          <option value="200" selected>200 bars</option>
          <option value="500">500 bars</option>
        </select>
        <button id="fetchBtn">Update</button>
      </div>
    </header>

    <div class="grid">
      <div>
        <div class="card" id="chartCard">
          <div id="chartWrapper">
            <canvas id="chartCanvas"></canvas>
          </div>
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <div class="card" style="flex:1">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="muted">RSI (14)</div>
              <div id="rsiVal" class="muted">-</div>
            </div>
            <div class="smallChart"><canvas id="rsiCanvas"></canvas></div>
          </div>

          <div class="card" style="width:260px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div class="muted">MACD</div>
              <div id="macdVal" class="muted">-</div>
            </div>
            <div class="smallChart"><canvas id="macdCanvas"></canvas></div>
          </div>
        </div>

      </div>

<aside class="rightCol">

  <div id="signalCard" class="card signalBadge hold">
    <div style="flex:1">
      <div id="signalText" class="signalText">HOLD</div>
      <div id="signalSub" class="signalDesc">No strong consensus yet</div>
    </div>
    <div style="text-align:right">
      <div class="conf" id="confidence">0%</div>
      <div class="muted">Confidence</div>
    </div>
  </div>

  <div id="preSignalCard" class="card signalBadge hold">
    <div style="flex:1">
      <div id="preSignalText" class="signalText">WAIT</div>
      <div id="preSignalSub" class="signalDesc">No early signal</div>
    </div>
    <div style="text-align:right">
      <div class="conf" id="preConfidence">0%</div>
      <div class="muted">Confidence</div>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div class="muted">Indicators</div>
      <div class="muted">Value</div>
    </div>
    <div class="metrics" id="metricList">
      <!-- dynamic metrics -->
    </div>
  </div>

  <div class="card explain">
    <strong>Decision logic</strong>
    <p id="decisionExplain">Score-based: each indicator gives +1/0/-1. Sum &gt;=3 =&gt; Strong BUY. Debounce: 2 bars.</p>
    <p style="margin-top:10px;" class="muted">Note: This demo uses free data APIs (may be delayed). Do not use for live execution.</p>
  </div>

</aside>

    </div>

    <footer class="muted">PLEASE NOTE: For educational/test purposes only, use at your own risk. We will not be reponsible for any loss.</footer>
  </div>
</body>


<script>
/* ---------------------------
   CONFIG - Paste your API key here
   --------------------------- */
const CONFIG = {
  API_PROVIDER: 'TwelveData',
  API_KEY: '9272246dda2d4a258c8f25a472ae5e0b',
  DEBOUNCE_BARS: 2,
  EMA_PERIOD: 13,
  RSI_PERIOD: 14,
  MACD_FAST: 12, MACD_SLOW: 26, MACD_SIGNAL: 9
};

function N(v){ return typeof v === 'number' ? v : parseFloat(v) || 0; }

/* Indicator Calculations */
function calculateEMA(values, period){ const k=2/(period+1);const ema=new Array(values.length).fill(null);if(values.length<period)return ema;const seed=values.slice(0,period).reduce((a,b)=>a+b,0)/period;ema[period-1]=seed;for(let i=period;i<values.length;i++){ema[i]=values[i]*k+ema[i-1]*(1-k);}return ema;}
function calculateRSI(values, period=14){const rsi=new Array(values.length).fill(null);if(values.length<=period)return rsi;let gains=0,losses=0;for(let i=1;i<=period;i++){const diff=values[i]-values[i-1];if(diff>=0)gains+=diff;else losses+=Math.abs(diff);}let avgGain=gains/period,avgLoss=losses/period;rsi[period]=avgLoss===0?100:100-(100/(1+(avgGain/avgLoss)));for(let i=period+1;i<values.length;i++){const diff=values[i]-values[i-1];const gain=diff>0?diff:0;const loss=diff<0?Math.abs(diff):0;avgGain=((avgGain*(period-1))+gain)/period;avgLoss=((avgLoss*(period-1))+loss)/period;const rs=avgLoss===0?100:avgGain/avgLoss;rsi[i]=100-(100/(1+rs));}return rsi;}
function calculateMACD(values,fast=12,slow=26,signal=9){const emaFast=calculateEMA(values,fast);const emaSlow=calculateEMA(values,slow);const macd=new Array(values.length).fill(null);for(let i=0;i<values.length;i++){if(emaFast[i]==null||emaSlow[i]==null){macd[i]=null;continue;}macd[i]=emaFast[i]-emaSlow[i];}const signalLine=calculateEMA(macd.map(v=>v===null?0:v),signal);const histogram=new Array(values.length).fill(null);for(let i=0;i<values.length;i++){if(macd[i]===null||signalLine[i]===null)histogram[i]=null;else histogram[i]=macd[i]-signalLine[i];}return{macd,signalLine,histogram};}
function calculateVWAP(candles){let cumPV=0,cumVol=0;const out=[];for(let i=0;i<candles.length;i++){const tp=(N(candles[i].high)+N(candles[i].low)+N(candles[i].close))/3;cumPV+=tp*N(candles[i].volume);cumVol+=N(candles[i].volume);out.push(cumVol===0?tp:(cumPV/cumVol));}return out;}

function indicatorState({price,vwap,ema,rsi,macdHist}){const s={};s.vwap=price>vwap?1:(Math.abs(price-vwap)/(vwap||price)<0.001?0:-1);s.ema=price>ema?1:(Math.abs(price-ema)/(ema||price)<0.001?0:-1);if(rsi==null)s.rsi=0;else if(rsi<30)s.rsi=1;else if(rsi>70)s.rsi=-1;else s.rsi=(rsi>=45&&rsi<=60)?1:0;if(macdHist==null)s.macd=0;else s.macd=macdHist>0?1:(macdHist<0?-1:0);return s;}
function scoreToSignal(score){if(score>=3)return{tag:'BUY',cls:'buy',desc:'Strong BUY'};if(score===2)return{tag:'BUY',cls:'buy',desc:'Weak BUY'};if(score===1||score===0)return{tag:'HOLD',cls:'hold',desc:'Neutral / Wait'};if(score===-1||score===-2)return{tag:'SELL',cls:'sell',desc:'Weak SELL'};return{tag:'SELL',cls:'sell',desc:'Strong SELL'};}

// -------------------- Pre-Signal Calculation --------------------
function calculatePreSignal({price, vwap, ema, rsi, macdHist}) {
  let score = 0;

  // VWAP proximity: price approaching VWAP
  if(price < vwap && (vwap - price)/vwap < 0.005) score += 1;
  else if(price > vwap && (price - vwap)/vwap < 0.005) score -= 1;

  // EMA proximity: price near EMA
  if(Math.abs(price - ema)/ema < 0.005) score += (price < ema ? 1 : -1);

  // RSI soft zones for early detection
  if(rsi >= 35 && rsi <= 45) score += 1;  // Pre-buy
  else if(rsi >= 55 && rsi <= 65) score -= 1; // Pre-sell

  // MACD histogram: shrinking momentum
  if(macdHist < 0 && Math.abs(macdHist) < 0.1) score += 1;
  else if(macdHist > 0 && macdHist < 0.1) score -= 1;

  if(score >= 2) return {tag:'PRE-BUY', cls:'buy', desc:'Early bullish signal'};
  if(score <= -2) return {tag:'PRE-SELL', cls:'sell', desc:'Early bearish signal'};
  return {tag:'WAIT', cls:'hold', desc:'No early signal'};
}

function updatePreSignalCard(preSignal, confidence) {
  const preText = document.getElementById('preSignalText');
  const preSub = document.getElementById('preSignalSub');
  const preConf = document.getElementById('preConfidence');

  preText.innerText = preSignal.tag;
  preSub.innerText = `${preSignal.desc}`;
  preConf.innerText = `${confidence}%`;
  document.getElementById('preSignalCard').className = 'card signalBadge ' + preSignal.cls;
}


const fetchBtn=document.getElementById('fetchBtn');
const symbolInput=document.getElementById('symbol');
const intervalSelect=document.getElementById('interval');
const rangeSelect=document.getElementById('chartRange');
const signalText=document.getElementById('signalText');
const signalCard=document.getElementById('signalCard');
const signalSub=document.getElementById('signalSub');
const confidenceEl=document.getElementById('confidence');
const metricList=document.getElementById('metricList');
const rsiVal=document.getElementById('rsiVal');
const macdVal=document.getElementById('macdVal');

let lastSignals=[];

/* Chart setup */
const mainCtx=document.getElementById('chartCanvas').getContext('2d');
const rsiCtx=document.getElementById('rsiCanvas').getContext('2d');
const macdCtx=document.getElementById('macdCanvas').getContext('2d');

const mainChart=new Chart(mainCtx,{type:'line',data:{datasets:[
  {label:'Price',data:[],borderColor:'#89e0ff',borderWidth:2,pointRadius:0,tension:0.2},
  {label:'VWAP',data:[],borderColor:'#6b5bff',borderWidth:1.5,borderDash:[6,4],pointRadius:0,tension:0},
  {label:`EMA(${CONFIG.EMA_PERIOD})`,data:[],borderColor:'#00d07f',borderWidth:1.5,pointRadius:0,tension:0}
]},options:{maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{mode:'index',intersect:false}},
scales:{x:{type:'time',time:{tooltipFormat:"yyyy-MM-dd HH:mm"},grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#9fb0c7'}},
y:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#9fb0c7'}}}}});

const rsiChart=new Chart(rsiCtx,{type:'line',data:{datasets:[{label:'RSI',data:[],borderColor:'#ffcc66',borderWidth:1.6,pointRadius:0,tension:0}]},
options:{maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{type:'time',display:false},y:{min:0,max:100,ticks:{color:'#9fb0c7'},grid:{color:'rgba(255,255,255,0.03)'}}}}});
const macdChart=new Chart(macdCtx,{type:'bar',data:{datasets:[
  {label:'MACD hist',data:[],backgroundColor:[],borderWidth:0},
  {label:'MACD',data:[],type:'line',borderColor:'#6b5bff',borderWidth:1.6,pointRadius:0,tension:0},
  {label:'Signal',data:[],type:'line',borderColor:'#00d07f',borderWidth:1.2,pointRadius:0,tension:0}
]},options:{maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{type:'time',display:false},y:{grid:{color:'rgba(255,255,255,0.03)'},ticks:{color:'#9fb0c7'}}}}});

function resizeAll(){mainChart.resize();rsiChart.resize();macdChart.resize();}
window.addEventListener('resize',resizeAll);

/* Fetch Data */
async function fetchOHLC(symbol, interval, outputsize = 200) {
  const key = CONFIG.API_KEY;
  const url = `https://api.twelvedata.com/time_series?symbol=${encodeURIComponent(symbol)}&interval=${interval}&format=JSON&outputsize=${outputsize}&apikey=${key}`;
  const res = await fetch(url);
  const j = await res.json();

  if (j.status === 'error') throw new Error(j.message || 'API error');

  const rows = (j.values || []).slice().reverse();
  const candles = rows.map(r => ({
    time: r.datetime,
    open: N(r.open),
    high: N(r.high),
    low: N(r.low),
    close: N(r.close),
    volume: N(r.volume)
  }));

  // ðŸ”¹ Fetch quote data to get previous close & pre-market
  let prevClose = NaN, preMarket = NaN;
  try {
    const quoteUrl = `https://api.twelvedata.com/quote?symbol=${encodeURIComponent(symbol)}&apikey=${key}`;
    const quoteRes = await fetch(quoteUrl);
    const quoteData = await quoteRes.json();

    if (quoteData && !quoteData.status) {
      prevClose = quoteData.previous_close ? N(quoteData.previous_close) : NaN;
      preMarket = quoteData.prepost?.pre_market ? N(quoteData.prepost.pre_market) : NaN;
    }
  } catch (e) {
    console.warn('Quote fetch failed:', e);
  }

  // ðŸ”¹ Return everything together
  return {
    candles,
    meta: j.meta || {},
    prepost: j.prepost || null,
    prevClose,
    preMarket
  };
}


/* Update All */
async function updateAll() {
  try {
    const symbol = symbolInput.value.trim().toUpperCase();
    const interval = intervalSelect.value;
    const output = parseInt(rangeSelect.value, 10);
    if (!symbol) return;

    fetchBtn.disabled = true;
    fetchBtn.innerText = 'Loading...';
    const { candles, meta, prepost } = await fetchOHLC(symbol, interval, output + 100);
    fetchBtn.disabled = false;
    fetchBtn.innerText = 'Update';
    if (!candles.length) throw new Error('No data returned');

    const closes = candles.map(c => c.close);
    const vwap = calculateVWAP(candles);
    const ema = calculateEMA(closes, CONFIG.EMA_PERIOD);
    const rsi = calculateRSI(closes, CONFIG.RSI_PERIOD);
    const macdObj = calculateMACD(closes, CONFIG.MACD_FAST, CONFIG.MACD_SLOW, CONFIG.MACD_SIGNAL);

    const toPoints = (src, vals) => src.map((c, i) => ({ x: c.time.replace(' ', 'T'), y: vals[i] }));
    mainChart.data.datasets[0].data = toPoints(candles, closes).slice(-output);
    mainChart.data.datasets[1].data = toPoints(candles, vwap).slice(-output);
    mainChart.data.datasets[2].data = toPoints(candles, ema).filter(p => p.y != null).slice(-output);
    mainChart.update('none');

    rsiChart.data.datasets[0].data = toPoints(candles, rsi).filter(p => p.y != null).slice(-output);
    rsiChart.update('none');

    const macdPoints = toPoints(candles, macdObj.histogram).map(p => ({ x: p.x, y: p.y || 0 })).slice(-output);
    const macdColors = macdPoints.map(p => p.y > 0 ? 'rgba(38,208,123,0.18)' : 'rgba(255,107,107,0.12)');
    macdChart.data.datasets[0].data = macdPoints;
    macdChart.data.datasets[0].backgroundColor = macdColors;
    macdChart.data.datasets[1].data = toPoints(candles, macdObj.macd).filter(p => p.y != null).slice(-output);
    macdChart.data.datasets[2].data = toPoints(candles, macdObj.signalLine).filter(p => p.y != null).slice(-output);
    macdChart.update('none');

    // âœ… Indicator values
    const lastPrice = closes.at(-1);
    const lastVwap = vwap.at(-1);
    const lastEma = ema.at(-1);
    const lastRsi = rsi.at(-1);
    const lastMacdHist = macdObj.histogram.at(-1);
    const prevClose = meta.previous_close ? N(meta.previous_close) : NaN;
    const preMarket = prepost?.pre_market ? N(prepost.pre_market) : NaN;

    const states = indicatorState({ price: lastPrice, vwap: lastVwap, ema: lastEma, rsi: lastRsi, macdHist: lastMacdHist });
    const score = states.vwap + states.ema + states.rsi + states.macd;
    const signal = scoreToSignal(score);

    lastSignals.push(signal.tag);
    if (lastSignals.length > CONFIG.DEBOUNCE_BARS) lastSignals.shift();
    const stable = lastSignals.every(s => s === lastSignals[0]);
    const finalSignal = stable ? signal : { tag: 'HOLD', cls: 'hold', desc: 'Waiting for confirmation' };
    const confidence = Math.round((Math.abs(score) / 4) * 100);

    updateSignalCard(finalSignal, confidence, score);
    populateMetrics(states, { price: lastPrice, vwap: lastVwap, ema: lastEma, rsi: lastRsi, macdHist: lastMacdHist }, { prevClose, preMarket });

    // âœ… Pre-signal logic (now correctly scoped)
    const preSignal = calculatePreSignal({
      price: lastPrice,
      vwap: lastVwap,
      ema: lastEma,
      rsi: lastRsi,
      macdHist: lastMacdHist
    });

    let preConfidence = 0;
    if (preSignal.tag === 'PRE-BUY' || preSignal.tag === 'PRE-SELL') preConfidence = 100;
    updatePreSignalCard(preSignal, preConfidence);

  } catch (err) {
    fetchBtn.disabled = false;
    fetchBtn.innerText = 'Update';
    console.error(err);
    alert('Error: ' + (err.message || err));
  }
}


function updateSignalCard(signal,confidence,score){
  signalText.innerText=signal.tag;
  signalSub.innerText=`${signal.desc} â€” score ${score}`;
  confidenceEl.innerText=`${confidence}%`;
  signalCard.className='card signalBadge '+signal.cls;
}

function populateMetrics(states, vals, extra={prevClose:NaN, preMarket:NaN}) {
  metricList.innerHTML = '';

  const list = [
    {k:'Price', v:vals.price},
    {k:'VWAP', v:vals.vwap},
    {k:`EMA(${CONFIG.EMA_PERIOD})`, v:vals.ema},
    {k:`RSI(${CONFIG.RSI_PERIOD})`, v:vals.rsi},
    {k:'MACD hist', v:vals.macdHist},
    {k:'Prev Close', v:extra.prevClose},
    {k:'Pre-Market', v:extra.preMarket}
  ];

  list.forEach(it=>{
    const el = document.createElement('div'); 
    el.className='metric';
    el.innerHTML = `
      <div style='font-size:12px;color:var(--muted)'>${it.k}</div>
      <div style='font-weight:700'>${(it.v==null || isNaN(it.v))?'-':(typeof it.v==='number'?it.v.toFixed(2):it.v)}</div>
    `;
    metricList.appendChild(el);
  });

  rsiVal.innerText = vals.rsi==null?'-':vals.rsi.toFixed(2);
  macdVal.innerText = vals.macdHist==null?'-':vals.macdHist.toFixed(5);
}

fetchBtn.addEventListener('click',()=>{lastSignals=[];updateAll();});
setInterval(()=>{updateAll().catch(()=>{});},6500);
updateAll().catch(()=>{});
</script>

</body>
</html>
